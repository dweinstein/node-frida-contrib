#!/usr/bin/env node --harmony --harmony_arrow_functions
/*jshint node: true, esnext: true */
'use strict';
const frida = require('frida');
const co    = require('co');
const debug = require('debug')('screenshot');
const resolveDevice = require('../../../common/resolve-device');
const laif = require('../../../common/load-agent-into-frontmost');
const lib = require('../index')({});

function handleErr(err) {
  console.error(err.stack);
}

function onMessage(err, msg) {
  if (err) { throw err; }
  debug(msg);
  if(msg && msg.timestamp && msg.format && msg.pixels) {
    require('fs').writeFileSync('./'+msg.timestamp+'.'+msg.format, msg.pixels);
    process.exit(0);
  }
  process.exit(1);
}


resolveDevice()
  .then((device) => {
    lib.getScreenshot(device, onMessage);
  })
  .catch(handleErr);
